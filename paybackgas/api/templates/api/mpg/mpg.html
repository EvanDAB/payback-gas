{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<h2>MPG Calculator</h2>
{% csrf_token %}
<div>
    <label>Year</label>
    {{ form.year }}
</div>
<div>
    <label>Make</label>
    <select id='dev_make'></select>
</div>
<div>
    <label>Model</label>
    <select id='dev_model'></select>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    console.log('HEllo');
    var globalYear;
    $('#id_year').change(function() {
        console.log('something changed');
        var yearVal = $(this).val();
        var year = 1984 + parseInt(yearVal);
        globalYear = year;
        console.log('year is ', year);
        var url = 'https://fueleconomy.gov/ws/rest/vehicle/menu/make?year=' + year.toString();
        console.log(url);

        $.ajax({
            url: url,
            data: {
            'year': year
            },
            success: function(responseData) {
                var makeListData = responseData.getElementsByTagName('menuItems')[0].childNodes;
                console.log(makeListData.length);
                var makeList = [];
                for(var i=0; i < makeListData.length; i++) {
                    var item = makeListData[i].getElementsByTagName('value')[0]['textContent'];
                    console.log(item);
                    makeList.push({i, item});
                }
                console.log(makeList);
                var html_data = '<option value="">-------</option>';
                makeList.forEach(function(item){
                    console.log(item);
                    html_data += `<option id="make_id_${item.i}" value="${item.item}">${item.item}</option>"`
                })
                console.log(html_data);
                $("#dev_make").html(html_data);
                debugger;
            }
        })
    });
    $('#dev_make').change(function() {
        var make = $(this).val();
        console.log(make);
        console.log(globalYear);
        var url = 'https://fueleconomy.gov/ws/rest/vehicle/menu/model?year=' + globalYear.toString() + '&make=' + make;
        $.ajax({
            url: url,
            data: {
                'make': make
            },
            success: function(responseData) {
                var modelListData = responseData.getElementsByTagName('menuItems')[0].childNodes;
                console.log(modelListData)
                var modelList = [];
                for(var i=0; i < modelListData.length; i++) {
                    var item = modelListData[i].getElementsByTagName('value')[0]['textContent'];
                    console.log(item);
                    modelList.push({i, item});
                }
                console.log(modelList);
                var html_data = '<option value="">-------</option>';
                modelList.forEach(function(item){
                    console.log(item);
                    html_data += `<option id="model_id_${item.i}" value="${item.item}">${item.item}</option>"`
                })
                console.log(html_data);
                $("#dev_model").html(html_data);
            }
        })
    });
</script>
{% endblock %}